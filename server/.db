-- Create the database
CREATE DATABASE IF NOT EXISTS isaac0yen_school_management;
USE isaac0yen_school_management;

-- Create users table
CREATE TABLE `users` (
  `id` int NOT NULL,
  `name` varchar(255) NOT NULL,
  `email` varchar(255) NOT NULL,
  `password` varchar(255) NOT NULL,
  `role` enum('admin','student','lecturer') NOT NULL,
  `matric_no` varchar(20) DEFAULT NULL,
  `status` enum('ACTIVE','INACTIVE') NOT NULL DEFAULT 'ACTIVE',
  `phone` varchar(20) DEFAULT NULL,
  `classRep` tinyint(1) DEFAULT NULL,
  `level` int DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `fcm_token` varchar(255) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- Create faculty table
CREATE TABLE `faculty` (
  `id` int NOT NULL,
  `name` varchar(255) NOT NULL,
  `head` int DEFAULT NULL,
  `created_by` int DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- Create department table
CREATE TABLE department (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    faculty INT,
    head INT,
    created_by INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (faculty) REFERENCES faculty(id),
    FOREIGN KEY (head) REFERENCES users(id),
    FOREIGN KEY (created_by) REFERENCES users(id)
);

-- Create user_department table
CREATE TABLE `department` (
  `id` int NOT NULL,
  `name` varchar(255) NOT NULL,
  `faculty` int DEFAULT NULL,
  `head` int DEFAULT NULL,
  `created_by` int DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- Create course table
CREATE TABLE `course` (
  `id` int NOT NULL,
  `name` varchar(255) NOT NULL,
  `department` int DEFAULT NULL,
  `faculty` int DEFAULT NULL,
  `level` int UNSIGNED NOT NULL,
  `code` varchar(20) NOT NULL,
  `lecturer` int DEFAULT NULL,
  `created_by` int DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- Create room table
CREATE TABLE `room` (
  `id` int NOT NULL,
  `name` varchar(255) NOT NULL,
  `capacity` int NOT NULL,
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- Create timetable table
CREATE TABLE `timetable` (
  `id` int NOT NULL,
  `label` varchar(255) NOT NULL,
  `course` int DEFAULT NULL,
  `department` int DEFAULT NULL,
  `time_start` time NOT NULL,
  `time_end` time NOT NULL,
  `date` date NOT NULL,
  `level` int UNSIGNED NOT NULL,
  `room` int NOT NULL,
  `created_by` int DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- Create codes table
CREATE TABLE `codes` (
  `id` int NOT NULL,
  `email` varchar(255) NOT NULL,
  `code` int NOT NULL,
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `user_department` (
  `id` int NOT NULL,
  `user_id` int DEFAULT NULL,
  `department_id` int DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;




ALTER TABLE `codes`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `course`
--
ALTER TABLE `course`
  ADD PRIMARY KEY (`id`),
  ADD KEY `department` (`department`),
  ADD KEY `faculty` (`faculty`),
  ADD KEY `lecturer` (`lecturer`),
  ADD KEY `created_by` (`created_by`);

--
-- Indexes for table `department`
--
ALTER TABLE `department`
  ADD PRIMARY KEY (`id`),
  ADD KEY `faculty` (`faculty`),
  ADD KEY `head` (`head`),
  ADD KEY `created_by` (`created_by`);

--
-- Indexes for table `faculty`
--
ALTER TABLE `faculty`
  ADD PRIMARY KEY (`id`),
  ADD KEY `head` (`head`),
  ADD KEY `created_by` (`created_by`);

--
-- Indexes for table `room`
--
ALTER TABLE `room`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `timetable`
--
ALTER TABLE `timetable`
  ADD PRIMARY KEY (`id`),
  ADD KEY `course` (`course`),
  ADD KEY `created_by` (`created_by`),
  ADD KEY `timetable_ibfk_3` (`department`);

--
-- Indexes for table `users`
--
ALTER TABLE `users`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `email` (`email`);

--
-- Indexes for table `user_department`
--
ALTER TABLE `user_department`
  ADD PRIMARY KEY (`id`),
  ADD KEY `user_id` (`user_id`),
  ADD KEY `department_id` (`department_id`);






ALTER TABLE `codes`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `course`
--
ALTER TABLE `course`
  ADD PRIMARY KEY (`id`),
  ADD KEY `department` (`department`),
  ADD KEY `faculty` (`faculty`),
  ADD KEY `lecturer` (`lecturer`),
  ADD KEY `created_by` (`created_by`);

--
-- Indexes for table `department`
--
ALTER TABLE `department`
  ADD PRIMARY KEY (`id`),
  ADD KEY `faculty` (`faculty`),
  ADD KEY `head` (`head`),
  ADD KEY `created_by` (`created_by`);

--
-- Indexes for table `faculty`
--
ALTER TABLE `faculty`
  ADD PRIMARY KEY (`id`),
  ADD KEY `head` (`head`),
  ADD KEY `created_by` (`created_by`);

--
-- Indexes for table `room`
--
ALTER TABLE `room`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `timetable`
--
ALTER TABLE `timetable`
  ADD PRIMARY KEY (`id`),
  ADD KEY `course` (`course`),
  ADD KEY `created_by` (`created_by`),
  ADD KEY `timetable_ibfk_3` (`department`);

--
-- Indexes for table `users`
--
ALTER TABLE `users`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `email` (`email`);

--
-- Indexes for table `user_department`
--
ALTER TABLE `user_department`
  ADD PRIMARY KEY (`id`),
  ADD KEY `user_id` (`user_id`),
  ADD KEY `department_id` (`department_id`);

--
-- Change the default status to INACTIVE
--
ALTER TABLE `users` CHANGE `status` `status` ENUM('ACTIVE','INACTIVE') CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL DEFAULT 'INACTIVE';


-- Insert sample data

-- Users
INSERT INTO users (name, email, password, role) VALUES
('Admin User', 'admin@example.com', 'hashed_password', 'admin'),
('John Doe', 'john@example.com', 'hashed_password', 'lecturer'),
('Jane Smith', 'jane@example.com', 'hashed_password', 'student');

-- Faculty
INSERT INTO faculty (name, head, created_by) VALUES
('Science', 1, 1),
('Arts', 2, 1);

-- Department
INSERT INTO department (name, faculty, head, created_by) VALUES
('Computer Science', 1, 2, 1),
('Physics', 1, 2, 1),
('English', 2, 2, 1);

-- User Department
INSERT INTO user_department (user_id, department_id) VALUES
(2, 1),
(3, 1);

-- Course
INSERT INTO course (name, department, faculty, code, lecturer, created_by) VALUES
('Introduction to Programming', 1, 1, 'CS101', 2, 1),
('Advanced Physics', 2, 1, 'PH201', 2, 1);

-- Room
INSERT INTO room (name, capacity) VALUES
('Room A101', 50),
('Room B202', 30);

-- Timetable
INSERT INTO timetable (label, course, time_start, time_end, date, level, created_by) VALUES
('CS101 Lecture', 1, '09:00:00', '11:00:00', '2023-06-01', 1, 1),
('PH201 Lecture', 2, '14:00:00', '16:00:00', '2023-06-02', 2, 1);

-- Codes
INSERT INTO codes (email, code) VALUES
('newuser@example.com', 1234);
